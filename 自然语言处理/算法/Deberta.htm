<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=ProgId content=OneNote.File>
<meta name=Generator content="Microsoft OneNote 15">
<link id=Main-File rel=Main-File href=Deberta.htm>
<link rel=File-List href="Deberta.files/filelist.xml">
</head>

<body lang=zh-CN style='font-family:微软雅黑;font-size:36.0pt'>

<div style='direction:ltr;border-width:100%'>

<div style='direction:ltr;margin-top:0in;margin-left:0in;width:27.452in'>

<div style='direction:ltr;margin-top:0in;margin-left:0in;width:1.602in'>

<p style='margin:0in;font-family:微软雅黑;font-size:20.0pt'><span lang=en-US>D</span><span
lang=zh-CN>eb</span><span lang=en-US>erta</span></p>

</div>

<div style='direction:ltr;margin-top:.0423in;margin-left:0in;width:1.6687in'>

<p style='margin:0in;font-size:10.0pt;color:#767676'><span style='font-family:
Calibri'>2025</span><span style='font-family:微软雅黑'>年</span><span
style='font-family:Calibri'>9</span><span style='font-family:微软雅黑'>月</span><span
style='font-family:Calibri'>18</span><span style='font-family:微软雅黑'>日</span></p>

<p style='margin:0in;font-family:Calibri;font-size:10.0pt;color:#767676'>10:21</p>

</div>

<div style='direction:ltr;margin-top:1.1777in;margin-left:.7916in;width:26.6604in'>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span style='font-weight:
bold' lang=zh-CN>将标准的注意力得分计算分解为</span><span style='font-weight:bold'
lang=en-US>4</span><span style='font-weight:bold' lang=zh-CN>个部分：</span></p>

<p style='margin:0in;margin-left:.75in'><img src="Deberta.files/image001.jpg"
width=2192 height=555></p>

<p style='margin:0in;margin-left:.375in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<ul type=disc style='direction:ltr;unicode-bidi:embed;margin-top:0in;
 margin-bottom:0in'>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle'><span
     style='font-family:微软雅黑;font-size:36.0pt' lang=zh-CN>内容-内容项
     (Content-to-Content)： 基于词的语义内容向量</span><span style='font-weight:bold;
     font-family:微软雅黑;font-size:36.0pt' lang=en-US>Q_c</span><span
     style='font-family:微软雅黑;font-size:36.0pt' lang=zh-CN>和</span><span
     style='font-weight:bold;font-family:微软雅黑;font-size:36.0pt' lang=en-US>K_</span><span
     style='font-weight:bold;font-family:微软雅黑;font-size:36.0pt' lang=zh-CN>c</span><span
     style='font-family:微软雅黑;font-size:36.0pt' lang=zh-CN>计算注意力。这与原始Transformer的计算方式相同。</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle'><span
     style='font-family:微软雅黑;font-size:36.0pt' lang=zh-CN>内容-位置项
     (Content-to-Position)： 基于当前词的Query内容</span><span style='font-weight:bold;
     font-family:微软雅黑;font-size:36.0pt' lang=en-US>Q_c</span><span
     style='font-family:微软雅黑;font-size:36.0pt' lang=zh-CN>和相对位置的Key向量</span><span
     style='font-weight:bold;font-family:微软雅黑;font-size:36.0pt' lang=en-US>K_r</span><span
     style='font-family:微软雅黑;font-size:36.0pt' lang=zh-CN>计算注意力。</span></li>
</ul>

<p style='margin:0in;margin-left:.375in;font-family:微软雅黑;font-size:36.0pt'><span
lang=zh-CN>位置-内容项 (Position-to-Content)： 基于当前词的相对位置的Query向量</span><span
style='font-weight:bold' lang=en-US>Q_r</span><span lang=zh-CN>和内容</span><span
style='font-weight:bold' lang=en-US>K_c</span><span lang=zh-CN>计算注意力。</span></p>

<ul type=disc style='direction:ltr;unicode-bidi:embed;margin-top:0in;
 margin-bottom:0in'>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle'><span
     style='text-decoration:line-through;font-family:微软雅黑;font-size:36.0pt'>位置-位置项
     (Position-to-Position)： 由于本身就是相对位置，所以这一项没有必要了。</span></li>
</ul>

<p style='margin:0in;margin-left:.375in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<p style='margin:0in;margin-left:1.5in'><img src="Deberta.files/image002.jpg"
width=2207 height=1307></p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=en-US>P</span><span
lang=zh-CN>表示相对位置的</span><span lang=en-US>position embedding</span><span
lang=zh-CN>，论文（上图）中说</span><span lang=en-US>P</span><span lang=zh-CN>的大小是</span><span
lang=en-US>2k*</span><span lang=zh-CN>d，</span><span style='font-weight:bold'
lang=en-US>2</span><span style='font-weight:bold' lang=zh-CN>k就是最大相对距离，超出这个距离的就进行截断</span><span
lang=zh-CN>，其实和绝对位置的</span><span lang=en-US>position embedding</span><span
lang=zh-CN>是类似的，只不过相对位置</span><span lang=en-US>r</span><span lang=zh-CN>的</span><span
lang=en-US>position embedding</span><span lang=zh-CN>的需要由两个</span><span
lang=en-US>token</span><span lang=zh-CN>的位置</span><span lang=en-US>i</span><span
lang=zh-CN>和</span><span lang=en-US>j</span><span lang=zh-CN>得到，而绝对位置</span><span
lang=en-US>i</span><span lang=zh-CN>的</span><span lang=en-US>positio embedding</span><span
lang=zh-CN>只需要一个位置</span><span lang=en-US>i</span><span lang=zh-CN>即可。举例来解释：</span></p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>下表表示</span><span
style='font-weight:bold' lang=zh-CN>绝对位置</span><span lang=zh-CN>的</span><span
lang=en-US>position embedding </span><span lang=zh-CN>矩阵</span><span
lang=en-US>A</span><span lang=zh-CN>，</span><span lang=en-US>A_i</span><span
lang=zh-CN>表示序列第</span><span lang=en-US>i</span><span lang=zh-CN>个</span><span
lang=en-US>token</span><span lang=zh-CN>的</span><span lang=en-US>position
embedding</span><span lang=zh-CN>。</span></p>

<div style='direction:ltr'>

<table border=1 cellpadding=0 cellspacing=0 valign=top style='direction:ltr;
 border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width:
 1pt' title="" summary="">
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.2923in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'>位置</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.7902in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>e</span><span
  lang=en-US>mbedding_dim0</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.6194in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>e</span><span
  lang=en-US>mbedding_dim1</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.2305in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>e</span><span
  lang=en-US>mbedding_dim2</span></p>
  </td>
 </tr>
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.3118in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>绝对位置</span><span
  lang=en-US>0</span><span lang=zh-CN>（i</span><span lang=en-US>=0</span><span
  lang=zh-CN>）</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.7902in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>0.1</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.6194in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>0.2</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.2111in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>0.1</p>
  </td>
 </tr>
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.3118in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>绝对位置</span><span
  lang=en-US>1</span><span lang=zh-CN>（i</span><span lang=en-US>=1</span><span
  lang=zh-CN>）</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.7902in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.6194in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.2111in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
 </tr>
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.3118in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>绝对位置</span><span
  lang=en-US>2</span><span lang=zh-CN>（i</span><span lang=en-US>=2</span><span
  lang=zh-CN>）</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.7902in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.6194in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.2111in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
 </tr>
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.3118in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>绝对位置</span><span
  lang=en-US>3</span><span lang=zh-CN>（i</span><span lang=en-US>=3</span><span
  lang=zh-CN>）</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.7902in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.6194in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.2111in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
 </tr>
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.3118in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>绝对位置</span><span
  lang=en-US>4</span><span lang=zh-CN>（i</span><span lang=en-US>=4</span><span
  lang=zh-CN>）</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.7902in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.6194in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.2111in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
 </tr>
</table>

</div>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>下表表示</span><span
style='font-weight:bold' lang=zh-CN>相对位置</span><span lang=zh-CN>的</span><span
lang=en-US>position embedding </span><span lang=zh-CN>矩阵</span><span
lang=en-US>P</span><span lang=zh-CN>，</span><span lang=en-US>P_</span><span
lang=zh-CN>r表示相对距离为</span><span lang=en-US>r=i-j</span><span lang=zh-CN>的位置</span><span
lang=en-US>position embedding</span><span lang=zh-CN>。</span></p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>对于下表这个例子来说，</span><span
style='font-weight:bold' lang=zh-CN>最大相对距离是</span><span style='font-weight:
bold' lang=en-US>6</span><span style='font-weight:bold' lang=zh-CN>，即</span><span
style='font-weight:bold' lang=en-US>2*k=6</span><span style='font-weight:bold'
lang=zh-CN>，</span><span style='font-weight:bold' lang=en-US>k=3</span><span
style='font-weight:bold' lang=zh-CN>。为了使</span><span style='font-weight:bold'
lang=en-US>r</span><span style='font-weight:bold' lang=zh-CN>都是正数，可以让</span><span
style='font-weight:bold' lang=en-US>r+k</span><span style='font-weight:bold'
lang=zh-CN>，这样</span><span style='font-weight:bold' lang=en-US>r</span><span
style='font-weight:bold' lang=zh-CN>最小就是</span><span style='font-weight:bold'
lang=en-US>0</span><span style='font-weight:bold' lang=zh-CN>，最大是</span><span
style='font-weight:bold' lang=en-US>2k</span><span style='font-weight:bold'
lang=zh-CN>。</span></p>

<div style='direction:ltr'>

<table border=1 cellpadding=0 cellspacing=0 valign=top style='direction:ltr;
 border-collapse:collapse;border-style:solid;border-color:#A3A3A3;border-width:
 1pt' title="" summary="">
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.075in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'>位置</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.7902in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>e</span><span
  lang=en-US>mbedding_dim0</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.6194in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>e</span><span
  lang=en-US>mbedding_dim1</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.2305in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>e</span><span
  lang=en-US>mbedding_dim2</span></p>
  </td>
 </tr>
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.0944in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>相对位置</span><span
  lang=en-US>-2</span><span lang=zh-CN>（i</span><span lang=en-US>-</span><span
  lang=zh-CN>j</span><span lang=en-US>=-2</span><span lang=zh-CN>）</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.7902in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>0.1</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.6194in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>0.2</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.2111in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>0.1</p>
  </td>
 </tr>
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.0944in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>相对位置</span><span
  lang=en-US>-1</span><span lang=zh-CN>（i</span><span lang=en-US>-</span><span
  lang=zh-CN>j</span><span lang=en-US>=-1</span><span lang=zh-CN>）</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.7902in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.6194in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.2111in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
 </tr>
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.075in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>相对位置</span><span
  lang=en-US>0</span><span lang=zh-CN>（i</span><span lang=en-US>-</span><span
  lang=zh-CN>j</span><span lang=en-US>=-0</span><span lang=zh-CN>）</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.7902in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.6194in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.2305in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
 </tr>
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.075in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>相对位置</span><span
  lang=en-US>1</span><span lang=zh-CN>（i</span><span lang=en-US>-</span><span
  lang=zh-CN>j</span><span lang=en-US>=1</span><span lang=zh-CN>）</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.7902in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.6194in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.2305in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
 </tr>
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.075in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>相对位置</span><span
  lang=en-US>2</span><span lang=zh-CN>（i</span><span lang=en-US>-</span><span
  lang=zh-CN>j</span><span lang=en-US>=2</span><span lang=zh-CN>）</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.7902in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.6194in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.2305in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>..</p>
  </td>
 </tr>
 <tr>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.075in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>相对位置</span><span
  lang=en-US>3</span><span lang=zh-CN>（i</span><span lang=en-US>-</span><span
  lang=zh-CN>j</span><span lang=en-US>=3</span><span lang=zh-CN>）</span></p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:4.7902in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>&nbsp;</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.6194in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>&nbsp;</p>
  </td>
  <td style='border-style:solid;border-color:#A3A3A3;border-width:1pt;
  vertical-align:top;width:5.2305in;padding:2.0pt 3.0pt 2.0pt 3.0pt'>
  <p style='margin:0in;font-family:微软雅黑;font-size:36.0pt' lang=en-US>&nbsp;</p>
  </td>
 </tr>
</table>

</div>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span style='font-weight:
bold' lang=zh-CN>所以说，对于绝对位置编码来说，位置</span><span style='font-weight:bold'
lang=en-US>i</span><span style='font-weight:bold' lang=zh-CN>的</span><span
style='font-weight:bold' lang=en-US>position </span><span style='font-weight:
bold' lang=zh-CN>embedd</span><span style='font-weight:bold' lang=en-US>ing</span><span
style='font-weight:bold' lang=zh-CN>，</span><span style='font-weight:bold'
lang=en-US>A_i</span><span style='font-weight:bold' lang=zh-CN>，可以直接和该</span><span
style='font-weight:bold' lang=en-US>token</span><span style='font-weight:bold'
lang=zh-CN>的</span><span style='font-weight:bold' lang=en-US>content embedding</span><span
style='font-weight:bold' lang=zh-CN>相加来表示</span><span style='font-weight:bold'
lang=en-US>token</span><span style='font-weight:bold' lang=zh-CN>的整体</span><span
style='font-weight:bold' lang=en-US>embedding</span><span style='font-weight:
bold' lang=zh-CN>，</span><span style='font-weight:bold' lang=en-US>A_i+C_i</span><span
style='font-weight:bold' lang=zh-CN>；但是对于相对位置编码来说，</span><span
style='font-weight:bold' lang=en-US>P_</span><span style='font-weight:bold'
lang=zh-CN>r其实是</span><span style='font-weight:bold' lang=en-US>P_(i-j)</span><span
style='font-weight:bold' lang=zh-CN>，表示相对距离为</span><span style='font-weight:
bold' lang=en-US>r=i-j</span><span style='font-weight:bold' lang=zh-CN>的位置</span><span
style='font-weight:bold' lang=en-US>position embedding</span><span
style='font-weight:bold' lang=zh-CN>，无法直接和</span><span style='font-weight:bold'
lang=en-US>token i</span><span style='font-weight:bold' lang=zh-CN>的</span><span
style='font-weight:bold' lang=en-US>content embedding</span><span
style='font-weight:bold' lang=zh-CN>相加，</span><span style='font-weight:bold'
lang=en-US>A_i+P_(i-j)</span><span style='font-weight:bold' lang=zh-CN>不能表示</span><span
style='font-weight:bold' lang=en-US> token i</span><span style='font-weight:
bold' lang=zh-CN>的整体</span><span style='font-weight:bold' lang=en-US>embedding</span><span
style='font-weight:bold' lang=zh-CN>。</span></p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span style='font-weight:
bold' lang=zh-CN>也就是说，如果采用相对位置编码，就只能在计算</span><span style='font-weight:bold'
lang=en-US>Attention score</span><span style='font-weight:bold' lang=zh-CN>时引入相对位置信息，因为只有在计算</span><span
style='font-weight:bold' lang=en-US>attention score</span><span
style='font-weight:bold' lang=zh-CN>时，才会用到两个</span><span style='font-weight:
bold' lang=en-US>token i</span><span style='font-weight:bold' lang=zh-CN>和</span><span
style='font-weight:bold' lang=en-US>j</span><span style='font-weight:bold'
lang=zh-CN>，</span><span style='font-weight:bold' lang=en-US>Attention_i,j = ….
</span><span style='font-weight:bold' lang=zh-CN>，才能引入相对位置</span><span
style='font-weight:bold' lang=en-US>P_(i-j)</span><span style='font-weight:
bold' lang=zh-CN>。</span></p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span lang=zh-CN>上图中说到，</span><span
style='font-weight:bold' lang=en-US>P</span><span lang=zh-CN>表示相对位置的</span><span
lang=en-US>position embedding</span><span lang=zh-CN>，并且对于所有层是共享的，也就是说和绝对位置编码的做法不同，</span><span
style='font-weight:bold' lang=en-US>deberta</span><span style='font-weight:
bold' lang=zh-CN>中每一层都需要注入相对位置信息，</span><span lang=zh-CN>而标准的</span><span
lang=en-US>bert</span><span lang=zh-CN>中只需要在初始输入时将</span><span lang=en-US>content
embedding</span><span lang=zh-CN>和</span><span lang=en-US>position embedding</span><span
lang=zh-CN>相加作为输入即可，</span><span style='font-weight:bold' lang=zh-CN>后续层不需要显式注入位置信息。</span></p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'><span style='font-weight:
bold' lang=zh-CN>相对位置编码的核心是在 attention 计算中引入 token 间的相对距离信息，除了</span><span
style='font-weight:bold' lang=en-US>deberta</span><span style='font-weight:
bold' lang=zh-CN>这种</span><span style='font-weight:bold' lang=en-US>disentangle</span><span
style='font-weight:bold' lang=zh-CN>的方式，还有：</span></p>

<ul type=disc style='direction:ltr;unicode-bidi:embed;margin-top:0in;
 margin-bottom:0in'>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle'><span
     style='font-family:微软雅黑;font-size:36.0pt'>直接将相对位置编码作为偏置项融入 content-based 的
     attention；</span></li>
 <li style='margin-top:0;margin-bottom:0;vertical-align:middle'><span
     style='font-family:微软雅黑;font-size:36.0pt' lang=en-US>ROPE</span><span
     style='font-family:微软雅黑;font-size:36.0pt' lang=zh-CN>：核心思想：
     绝对位置信息可以通过旋转矩阵编码到Query和Key向量中。对于位置为 m 的词元，它的Query和Key向量会用一个依赖于 m 的旋转矩阵
     R_θ, m 进行旋转。</span></li>
</ul>

<p style='margin:0in;margin-left:.375in;font-family:微软雅黑;font-size:36.0pt'>计算过程：</p>

<p style='margin:0in;margin-left:.375in;font-family:微软雅黑;font-size:36.0pt'>对Q和K向量应用旋转变换：Q'_m
= R_θ, m * Q_m, K'_n = R_θ, n * K_n。</p>

<p style='margin:0in;margin-left:.375in;font-family:微软雅黑;font-size:36.0pt'>用变换后的Q'和K'计算注意力分数。</p>

<p style='margin:0in;margin-left:.375in;font-family:微软雅黑;font-size:36.0pt'>数学魔法：
变换后的注意力分数天然地包含了相对位置信息。</p>

<p style='margin:0in;margin-left:.375in;font-family:微软雅黑;font-size:36.0pt'>Q'_m^T
* K'_n = (R_θ, m * Q_m)^T * (R_θ, n * K_n) = Q_m^T R_θ, {m-n} K_n</p>

<p style='margin:0in;margin-left:.375in;font-family:微软雅黑;font-size:36.0pt'>最终的结果
R_θ, {m-n} 只依赖于相对位置 (m-n)！</p>

<p style='margin:0in;margin-left:.375in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<p style='margin:0in;margin-left:.375in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<p style='margin:0in;margin-left:.375in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<p style='margin:0in;margin-left:.375in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

<p style='margin:0in;font-family:微软雅黑;font-size:36.0pt'>&nbsp;</p>

</div>

</div>

</div>

<div>

<p style='margin:0in'>&nbsp;</p>

<p style='text-align:left;margin:0in;font-family:Arial;font-size:9pt;
color:#969696;direction:ltr'>已使用 OneNote 创建。</p>

</div>

</body>

</html>
